<div class='mainContainer'>
	<div class='puzzleCanvas'>	
		<img class='puzzleSolved' src='_Puzzle_solved.png'>
		<img class='puzzleUnsolved' src='_Puzzle_bg_unsolved.png'>

		<div data-match='05' data-occupied='false' class='match'></div>
		<div data-match='06' data-occupied='false' class='match'></div>
		<div data-match='07' data-occupied='false' class='match'></div>
		<div data-match='08' data-occupied='false' class='match'></div>
		<div data-match='09' data-occupied='false' class='match'></div>
		<div data-match='10' data-occupied='false' class='match'></div>
		<div data-match='11' data-occupied='false' class='match'></div>
		<div data-match='12' data-occupied='false' class='match'></div>
		<div data-match='13' data-occupied='false' class='match'></div>
		<div data-match='14' data-occupied='false' class='match'></div>
		<div data-match='15' data-occupied='false' class='match'></div>
		<div data-match='16' data-occupied='false' class='match'></div>
		<div data-match='17' data-occupied='false' class='match'></div>
		<div data-match='19' data-occupied='false' class='match'></div>
		<div data-match='20' data-occupied='false' class='match'></div>
		<div data-match='21' data-occupied='false' class='match'></div>
		<div data-match='22' data-occupied='false' class='match'></div>
		<div data-match='23' data-occupied='false' class='match'></div>
		<div data-match='24' data-occupied='false' class='match'></div>
		<div data-match='25' data-occupied='false' class='match'></div>
		<div data-match='26' data-occupied='false' class='match'></div>
		<div data-match='27' data-occupied='false' class='match'></div>
		<div data-match='28' data-occupied='false' class='match'></div>
		<div data-match='29' data-occupied='false' class='match'></div>
		<div data-match='30' data-occupied='false' class='match'></div>
		<div data-match='31' data-occupied='false' class='match'></div>
		<div data-match='32' data-occupied='false' class='match'></div>
		<div data-match='33' data-occupied='false' class='match'></div>




		<div class='temp'>
		<img data-match='05' class='shadowed' src='pieces/Group 5.png'>
		<img data-match='06' class='shadowed' src='pieces/Group 6.png'>
		<img data-match='07' class='shadowed' src='pieces/Group 7.png'>
		<img data-match='08' class='shadowed' src='pieces/Group 8.png'>
		<img data-match='09' class='shadowed' src='pieces/Group 9.png'>
		<img data-match='10' class='shadowed' src='pieces/Group 10.png'>
		<img data-match='11' class='shadowed' src='pieces/Group 11.png'>
		<img data-match='12' class='shadowed' src='pieces/Group 12.png'>
		<img data-match='13' class='shadowed' src='pieces/Group 13.png'>
		<img data-match='14' class='shadowed' src='pieces/Group 14.png'>
		<img data-match='15' class='shadowed' src='pieces/Group 15.png'>
		<img data-match='16' class='shadowed' src='pieces/Group 16.png'>
		<img data-match='17' class='shadowed' src='pieces/Group 17.png'>
		<img data-match='19' class='shadowed' src='pieces/Group 19.png'>
		<img data-match='20' class='shadowed' src='pieces/Group 20.png'>
		<img data-match='21' class='shadowed' src='pieces/Group 21.png'>
		<img data-match='22' class='shadowed' src='pieces/Group 22.png'>
		<img data-match='23' class='shadowed' src='pieces/Group 23.png'>
		<img data-match='24' class='shadowed' src='pieces/Group 24.png'>
		<img data-match='25' class='shadowed' src='pieces/Group 25.png'>
		<img data-match='26' class='shadowed' src='pieces/Group 26.png'>
		<img data-match='27' class='shadowed' src='pieces/Group 27.png'>
		<img data-match='28' class='shadowed' src='pieces/Group 28.png'>
		<img data-match='29' class='shadowed' src='pieces/Group 29.png'>
		<img data-match='30' class='shadowed' src='pieces/Group 30.png'>
		<img data-match='31' class='shadowed' src='pieces/Group 31.png'>
		<img data-match='32' class='shadowed' src='pieces/Group 32.png'>
		<img data-match='33' class='shadowed' src='pieces/Group 33.png'>





		</div>
	</div>

	<div class='difficultyContainer'>
		<h2>Select Difficulty</h2>
		<button class='uv'>Novice</button>
		<button class='nightmare'>Nightmare</button>
	</div>
</div>

<button class='startPuzzle'>Begin</button>



<style>
	@import url('https://fonts.googleapis.com/css?family=Orbitron');

	@font-face {
  	font-family: 'Doom', serif;
  	src: url('AmazDooMLeft.ttf'); 
	}

	@keyframes fadeIn {
		from {
			opacity: 0;`
		}
		to {
			opacity: 1;
		}
	}

	@keyframes fadeOut {
		from {
			opacity: 1;
		}
		to {
			opacity: 0;
		}
	}

	* {
		box-sizing: border-box;
	}


	img {
		display: block;
	/*	margin: auto;*/
		max-width: 100%;
	}

	body {
		user-select: none;
		overflow: hidden;
	}

	html {
		background-color: #2a2a2a;
		font-family: 'Orbitron', sans-serif;
		font-size: 1.2em;
	}

	.puzzleCanvas {
		width: 868px;
		height: 579px;
		position: absolute;
		margin: 0 auto;
	}

	.puzzleSolved, .puzzleUnsolved, .puzzlePiece {
		box-shadow: 10px 10px 5px 1px rgba(0,0,0,0.16);
	}

	.puzzleUnsolved {
		animation: fadeIn 2s ease;
	}

	.mainContainer {
		width: 860px;
		margin: 0 auto;
		margin-top: 12px;
		border: 2px solid white;
		height: 579px;
	}	

	.startPuzzle {
		display: block;
		width: 250px;
		margin: 0 auto;
		margin-top: 5px;
		text-transform: uppercase;
	}

	.difficultyContainer > button {
		display: block;
		width: 55%;
		margin: 0 auto;
		margin-bottom: 27px;
	}

	.difficultyContainer {
		position: relative;
		width: 425px;
		margin: 0 auto;
		top: 20%;
	}

	button {
		cursor: pointer;
		font-family: 'Orbitron', sans-serif;
		font-size: .89em;
		transition: all .2s ease;
		border: 2px solid white;
		opacity: .85;
		padding: 21px;
	}

	button:hover {
		opacity: 1;
		background-color: #ec1d88;
	}

	button:focus {
		outline:0;
	}

	h2 {
		color: white;
		text-align: center;
	}

	.hidden {
		display: none;
	}

	.shadowed {
    	filter: drop-shadow(6px 4px 2px rgba(0,0,0,0.5));
    	position: absolute;
    	z-index: 20;
	}

	.noShadow {
		filter: drop-shadow(0px 0px 0px rgba(0,0,0,0));
	}

	/*///////////////////new rules//////////////////*/

	.match {
		background-color: grey;
		width: 110px;
		height: 95px;
		margin-left: 50px;
	}

	.highZindexValue {
		z-index: 99;
	}

	.lowZindexValue {
		z-index: 1;
		border: 2px solid green;
	}


	body {
		user-select: none;
	}

	/****TIME FUCKER***/

/*	img[data-match]{
		position: absolute;
		border: 2px solid red;
	}
*/

	.temp > img {
		position: absolute;
	}

	img[data-match="05"]{
		border: 2px solid purple;
		left: 350px;
	}

	img[data-match="06"]{
		border: 2px solid blue;
	}

	img[data-match="07"]{
		border: 2px solid pink;
	}

	img[data-match="08"]{
		border: 2px solid darkorange;
	}

	img[data-match="09"]{
		border: 2px solid antiquewhite;
	}

	img[data-match="10"]{
		border: 2px solid darkgreen;
	}

	img[data-match="11"]{
		border: 2px solid darkgoldenrod;
	}

	img[data-match="12"]{
		border: 2px solid red;
	}

	img[data-match="13"]{
		border: 2px solid fuchsia;
	}

	img[data-match="14"]{
		border: 2px solid black;
	}

	img[data-match="15"]{
		border: 2px solid chartreuse;
	}

	img[data-match="16"]{
		border: 2px solid cornflowerblue;
	}

	img[data-match="17"]{
		border: 2px solid chocolate;
	}

	img[data-match="19"]{
		border: 2px solid crimson;
	}

	img[data-match="20"]{
		border: 2px solid darkslategray;
	}

	img[data-match="21"]{
		border: 2px solid lightpink;
	}

	img[data-match="22"]{
		border: 2px solid olive;
	}

	img[data-match="23"]{
		border: 2px solid white;
	}

	img[data-match="24"]{
		border: 2px solid blue;
	}

	img[data-match="25"]{
		border: 2px solid red;
	}

	img[data-match="26"]{
		border: 2px solid purple;
	}

	img[data-match="27"]{
		border: 2px solid yellow;
		left: 220px;
	}

	img[data-match="28"]{
		border: 2px solid beige;
	}

	img[data-match="29"]{
		border: 2px solid black;
	}

	img[data-match="30"]{
		border: 2px solid red;
	}

	img[data-match="31"]{
		border: 2px solid fuchsia;
	}

	img[data-match="32"]{
		border: 2px solid yellow;
	}

	img[data-match="33"]{
		border: 2px solid orange;
	}




	/*position puzzle container divs*/
	div[data-match]{
		width: 110px;
		position: absolute;
		opacity: .2;
	}

	/*************************************************/

	div[data-match='05']{
		bottom: 147px;
		left: 658px;
		background-color: purple;
	}

	div[data-match='06']{
		bottom: 244px;
		left: 658px;
		background-color: blue;
	}

	div[data-match='07']{
		left: 575px;
		bottom: 99px;
		background-color: pink;
	}

	div[data-match='08']{
		bottom: 197px;
    	left: 574px;
		background-color: darkorange;
	}

	div[data-match='09']{
		left: 492px;
		bottom: 147px;
		background-color: antiquewhite;
	}

	div[data-match='10']{
		left: 492px;
		bottom: 242px;
		background-color: darkgreen;
	}

	div[data-match='11']{
		left: 405px;
		bottom: 99px;
		background-color: darkgoldenrod;
	}

	div[data-match='12']{
		left: 405px;
		bottom: 194px;
		background-color: red;
	}

	div[data-match='13']{
		left: 325px;
		bottom: 147px;
		background-color: fuchsia;
	}

	div[data-match='14']{
		left: 325px;
		bottom: 242px;
		background-color: black;
	}

	div[data-match='15']{
		left: 239px;
		bottom: 99px;
		background-color: chartreuse;
	}

	div[data-match='16']{
		left: 239px;
		bottom: 194px;
		background-color: cornflowerblue;
	}

	div[data-match='17']{
		bottom: 144px;
		left: 158px;
		background-color: chocolate;
	}

	div[data-match='19']{
		bottom: 50px;
		left: 658px;
		background-color: crimson;
	}

	div[data-match='20']{
		bottom: 50px;
		left: 492px;
		background-color: darkslategray;
	}

	div[data-match='21']{
		bottom: 50px;
		left: 325px;
		background-color: lightpink;
	}

	div[data-match='22']{
		bottom: 50px;
		left: 157px;
		background-color: olive;
	}

	div[data-match='23']{
		bottom: 50px;
		left: -9px;
		background-color: white;
	}

	div[data-match='24']{
		bottom: 98px;
		left: 75px;
		background-color: blue;
	}

	div[data-match='25']{
		bottom: 194px;
		left: 75px;
		background-color: red;
	}

	div[data-match='26']{
		bottom: 145px;
		left: -9px;
		background-color: purple;
	}

	div[data-match='27']{
		bottom: 243px;
		left: -8px;
		background-color: yellow;
	}

	div[data-match='28']{
		bottom: 341px;
		left: 658px;
		background-color: beige;
	}

	div[data-match='29']{
		bottom: 438px;
		left: 658px;
		background-color: black;
	}

	div[data-match='30']{
		left: 579px;
		bottom: 293px;
		background-color: red;
	}

	div[data-match='31']{
		bottom: 389px;
		left: 578px;
		background-color: fuchsia;
	}

	div[data-match='32']{
		left: 495px;
		bottom: 341px;
		background-color: yellow;
	}

	div[data-match='33']{
		left: 495px;
		bottom: 438px;
		background-color: orange;
	}


	div[data-occupied="true"] {
	  border: 5px dashed red;
	}


/*	img[data-match]{
		border: none;
	}

	div[data-match]{
		border: none;
	}*/

</style>

<script>
var startPuzzle = document.querySelector('.startPuzzle'),
puzzleSolved = document.querySelector('.puzzleSolved'),
puzzleUnsolved = document.querySelector('.puzzleUnsolved'),
difficultyContainer = document.querySelector('.difficultyContainer'),
heartParent = document.querySelector('.temp'),
nightmareMode;

var puzzlePieces = document.querySelectorAll('.temp > img');
var divContainers = document.querySelectorAll('div.match');

var pistol = new Audio('sounds/dspistol.wav'),
vault = new Audio('sounds/vault.mp3'),
xcom = new Audio('sounds/xcom.mp3');

var hoof = new Audio('sounds/dshoof.wav');
hoof.volume = .32;
var pickup = new Audio('sounds/dsitemup.wav');

pistol.volume = .45;

var uv = document.querySelector('.uv'),
nightmare = document.querySelector('.nightmare');

var difficultyButtons = document.querySelectorAll('.difficultyContainer > button')

startPuzzle.addEventListener('click', function(){
	pistol.currentTime = 0;
	pistol.play();
	// puzzleSolved.classList.add('hidden');
	// puzzleUnsolved.classList.remove('hidden');
	heartParent.classList.remove('hidden');
});

difficultyButtons.forEach(function(button){
	button.addEventListener('mouseenter', function(){
		vault.currentTime = 0; //rewind audio element to the start
		vault.play();
	});

	button.addEventListener('click', function(){
		pistol.currentTime = 0;
		vault.pause();
		pistol.play();
		startPuzzle.classList.remove('hidden');
		difficultyContainer.classList.add('hidden');
	});
});

nightmare.addEventListener('click', function(){
	nightmareMode = true;
	console.log('nightmare mode:', nightmareMode)
});

//if(!nightmare) - add hints etc. 

function initGame(){
	//call function to set state at beginning
	//call again to reset game state	
	// startPuzzle.style.display = 'none';
	puzzleSolved.classList.remove('hidden');
	puzzleUnsolved.classList.add('hidden');
	startPuzzle.classList.add('hidden');
	difficultyContainer.classList.remove('hidden');
	heartParent.classList.add('hidden');
	nightmareMode = false;
	console.log('init game')
};

//*new code*//

puzzlePieces.forEach(function(piece){
	piece.clicked = false;
	//set default value of piece.clicked to false
	piece.addEventListener('click', selectPiece)
});

function selectPiece(e){
	var piece = this;
	this.clicked = !this.clicked
	piece.classList.remove('noShadow');

	if(this.clicked){
		pickup.play();	
		this.classList.toggle('highZindexValue');
	} else {
		this.classList.toggle('highZindexValue');
	}

	divContainers.forEach(function(container){
		if(checkBoundary(piece, container)){
			lockPiece(piece, container);
			checkWin();
		} 
	});

	resetDivContainers()
	boardState()

}

window.addEventListener('mousemove', function(evt){
	puzzlePieces.forEach(function(piece){
		if(piece.clicked){
			var pieceParent = piece.offsetParent.getBoundingClientRect();
			piece.style.left = evt.clientX - pieceParent.x - 55 + 'px';
			piece.style.top = evt.clientY - pieceParent.y - 55 + 'px';
		} else {
			return;
		}
	})
})


function boardState(){
	divContainers.forEach(function(divContainer){
		puzzlePieces.forEach(function(puzzlePiece){
			if (checkBoundary(puzzlePiece, divContainer)) {
        	divContainer.dataset.occupied = "true";
      		}
		})
	})
}

function resetDivContainers(){
	divContainers.forEach(function(divContainer){
		divContainer.dataset.occupied = "false";
	})
}


function checkBoundary(puzzlePiece, currentDiv){
	var currentDiv = currentDiv;
	var divBoundary = currentDiv.getBoundingClientRect();

	if(between(puzzlePiece.getBoundingClientRect().x, divBoundary.left - 15, divBoundary.right - 55) 
		&& between(puzzlePiece.getBoundingClientRect().y, divBoundary.top - 15, divBoundary.bottom - 85) 
		&& !puzzlePiece.clicked) {	
				return true;
	} else {
		return false;
	}
}

function lockPiece(puzzlePiece, divContainer){
	if(divContainer.dataset.occupied === 'false'){
		var divBoundary = divContainer.getBoundingClientRect();
		var divParent = divContainer.offsetParent.getBoundingClientRect();
		
		puzzlePiece.classList.add('noShadow');
		puzzlePiece.style.top = divBoundary.top - divParent.y + 'px';
		puzzlePiece.style.left = divBoundary.left - divParent.x + 'px';

		hoof.play();
	} else {
		return
	}
}

function between(input, min, max) {
  return input >= min && input <= max;
}

function checkWin(){
	var total = 0;
	divContainers.forEach(function(container){
		puzzlePieces.forEach(function(puzzlePiece){
			if(checkBoundary(puzzlePiece, container) && puzzlePiece.dataset.match === container.dataset.match){
				total++;
			}
		})
	})
	
	if(total === divContainers.length){
		console.log('you win')
	}
}

/*existing code*/

initGame();

</script>

